<!-- templates/cad_hub/brandschutz/dashboard.html -->
{% extends "cad_hub/brandschutz/base_brandschutz.html" %}

{% block page_actions %}
<a href="{% url 'cad_hub:brandschutz:pruefung_create' %}" 
   class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium flex items-center gap-2">
    ‚ûï Neue Pr√ºfung
</a>
{% endblock %}

{% block brandschutz_content %}
<!-- Statistik-Karten -->
<div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8">
    <div class="bg-slate-800 rounded-xl p-4 border border-slate-700">
        <div class="text-3xl font-bold text-white">{{ stats.gesamt }}</div>
        <div class="text-slate-400 text-sm">Pr√ºfungen gesamt</div>
    </div>
    <div class="bg-slate-800 rounded-xl p-4 border border-slate-700">
        <div class="text-3xl font-bold text-blue-400">{{ stats.in_pruefung }}</div>
        <div class="text-slate-400 text-sm">In Pr√ºfung</div>
    </div>
    <div class="bg-slate-800 rounded-xl p-4 border border-slate-700">
        <div class="text-3xl font-bold text-yellow-400">{{ stats.maengel }}</div>
        <div class="text-slate-400 text-sm">Mit M√§ngeln</div>
    </div>
    <div class="bg-slate-800 rounded-xl p-4 border border-slate-700">
        <div class="text-3xl font-bold text-green-400">{{ stats.freigegeben }}</div>
        <div class="text-slate-400 text-sm">Freigegeben</div>
    </div>
    <div class="bg-slate-800 rounded-xl p-4 border border-red-700 bg-red-900/20">
        <div class="text-3xl font-bold text-red-400">{{ mangel_stats.kritisch }}</div>
        <div class="text-slate-400 text-sm">Kritische M√§ngel</div>
    </div>
    <div class="bg-slate-800 rounded-xl p-4 border border-orange-700 bg-orange-900/20">
        <div class="text-3xl font-bold text-orange-400">{{ mangel_stats.hoch }}</div>
        <div class="text-slate-400 text-sm">Hohe Priorit√§t</div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Letzte Pr√ºfungen -->
    <div class="bg-slate-800 rounded-xl border border-slate-700">
        <div class="p-4 border-b border-slate-700 flex items-center justify-between">
            <h2 class="text-lg font-semibold text-white">üìã Letzte Pr√ºfungen</h2>
            <a href="{% url 'cad_hub:brandschutz:pruefung_list' %}" class="text-sm text-blue-400 hover:text-blue-300">
                Alle anzeigen ‚Üí
            </a>
        </div>
        <div class="divide-y divide-slate-700">
            {% for pruefung in letzte_pruefungen %}
            <a href="{% url 'cad_hub:brandschutz:pruefung_detail' pruefung.pk %}" 
               class="block p-4 hover:bg-slate-700/50 transition">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="font-medium text-white">{{ pruefung.titel }}</div>
                        <div class="text-sm text-slate-400">{{ pruefung.projekt_name }}</div>
                    </div>
                    <div class="text-right">
                        <span class="px-2 py-1 rounded text-xs font-medium
                            {% if pruefung.status == 'freigegeben' %}bg-green-900 text-green-300
                            {% elif pruefung.status == 'maengel' %}bg-red-900 text-red-300
                            {% elif pruefung.status == 'in_pruefung' %}bg-blue-900 text-blue-300
                            {% else %}bg-slate-700 text-slate-300{% endif %}">
                            {{ pruefung.get_status_display }}
                        </span>
                        <div class="text-xs text-slate-500 mt-1">
                            {{ pruefung.pruef_datum|date:"d.m.Y" }}
                        </div>
                    </div>
                </div>
            </a>
            {% empty %}
            <div class="p-8 text-center text-slate-500">
                Keine Pr√ºfungen vorhanden
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Dringende M√§ngel -->
    <div class="bg-slate-800 rounded-xl border border-slate-700">
        <div class="p-4 border-b border-slate-700 flex items-center justify-between">
            <h2 class="text-lg font-semibold text-white">‚ö†Ô∏è Dringende M√§ngel</h2>
            <span class="px-2 py-1 bg-red-900 text-red-300 rounded text-sm">
                {{ mangel_stats.gesamt }} offen
            </span>
        </div>
        <div class="divide-y divide-slate-700 max-h-96 overflow-y-auto">
            {% for mangel in dringende_maengel %}
            <div class="p-4 hover:bg-slate-700/50 transition">
                <div class="flex items-start gap-3">
                    <span class="mt-1 flex-shrink-0 w-2 h-2 rounded-full
                        {% if mangel.schweregrad == 'kritisch' %}bg-red-500
                        {% else %}bg-orange-500{% endif %}">
                    </span>
                    <div class="flex-1 min-w-0">
                        <div class="text-sm text-white">{{ mangel.beschreibung|truncatewords:20 }}</div>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="text-xs px-2 py-0.5 rounded
                                {% if mangel.schweregrad == 'kritisch' %}bg-red-900 text-red-300
                                {% else %}bg-orange-900 text-orange-300{% endif %}">
                                {{ mangel.schweregrad|upper }}
                            </span>
                            <a href="{% url 'cad_hub:brandschutz:pruefung_detail' mangel.pruefung.pk %}" 
                               class="text-xs text-slate-400 hover:text-white">
                                {{ mangel.pruefung.titel|truncatewords:3 }}
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="p-8 text-center text-slate-500">
                <span class="text-4xl">‚úÖ</span>
                <div class="mt-2">Keine dringenden M√§ngel</div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
    <a href="{% url 'cad_hub:brandschutz:analyse' %}" 
       class="bg-gradient-to-r from-red-600 to-orange-600 rounded-xl p-6 hover:from-red-500 hover:to-orange-500 transition">
        <div class="text-2xl mb-2">üìê</div>
        <div class="text-lg font-semibold text-white">CAD-Analyse</div>
        <div class="text-sm text-red-200">DXF/IFC auf Brandschutz pr√ºfen</div>
    </a>
    <a href="{% url 'cad_hub:brandschutz:regelwerk_list' %}" 
       class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl p-6 hover:from-blue-500 hover:to-indigo-500 transition">
        <div class="text-2xl mb-2">üìã</div>
        <div class="text-lg font-semibold text-white">Regelwerke</div>
        <div class="text-sm text-blue-200">ASR, DIN, MBO, ATEX...</div>
    </a>
    <a href="{% url 'cad_hub:brandschutz:pruefung_list' %}?status=maengel" 
       class="bg-gradient-to-r from-yellow-600 to-amber-600 rounded-xl p-6 hover:from-yellow-500 hover:to-amber-500 transition">
        <div class="text-2xl mb-2">üîß</div>
        <div class="text-lg font-semibold text-white">M√§ngelbehebung</div>
        <div class="text-sm text-yellow-200">{{ mangel_stats.gesamt }} offene M√§ngel</div>
    </a>
</div>
{% endblock %}
